+++
title = "Generating a link-local address from a MAC address in Perl"
description = """
A code snippet for generating an IPv6 link-local address from a MAC address
"""

[taxonomies]
# see `docs/tags_in_use.md` for a list of all tags currently in use.
tags = [
    "ipv6",
    "perl",
]

[extra]
+++

## Example

### On the host
```txt
$ ip address show dev eth0
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether aa:00:00:4b:a0:c1 brd ff:ff:ff:ff:ff:ff
[â€¦]
    inet6 fe80::a800:ff:fe4b:a0c1/64 scope link 
       valid_lft forever preferred_lft forever
```

### Generated by script
```txt
$ lladdr.pl aa:00:00:4b:a0:c1
fe80::a800:ff:fe4b:a0c
```

## Code

```perl
#!/usr/bin/env perl

use warnings;
use strict;
use 5.010;

if (not defined $ARGV[0]) {
    die "Usage: $0 MAC-ADDRESS"
}

my $mac = $ARGV[0];

if ($mac !~ /^
    \p{PosixXDigit}{2}:
    \p{PosixXDigit}{2}:
    \p{PosixXDigit}{2}:
    \p{PosixXDigit}{2}:
    \p{PosixXDigit}{2}:
    \p{PosixXDigit}{2}
    /ix) {
    die "'$mac' doesn't look like a MAC address";
}

my @octets = split(/:/, $mac);

# Algorithm:
# 1. Prepend 'fe80::' for the first 64 bits of the IPv6
# 2. Next 16 bits: Use first octet with 7th bit flipped, and second octet
#    appended
# 3. Next 16 bits: Use third octet with 'ff' appended
# 4. Next 16 bits: Use 'fe' with fourth octet appended
# 5. Next 16 bits: Use 5th octet with 6th octet appended
# = 128 bits.
printf "fe80::%x%02x:%x:%x:%x\n",
    hex($octets[0]) ^ 2,
    hex($octets[1]),
    hex($octets[2] . 'ff'),
    hex('fe' . $octets[3]),
    hex($octets[4] . $octets[5]);
```

## See also

* [How to do it in bash](https://unix.stackexchange.com/a/79352/36243)
* [Why We Flip the 7th Bit in EUI-64: A Comprehensive Analysis](https://community.cisco.com/t5/networking-knowledge-base/why-we-flip-the-7th-bit-in-eui-64-a-comprehensive-analysis/ta-p/4951015)
